<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trigger PDF Generation and Upload</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        #status { margin-top: 15px; padding: 10px; border: 1px solid #eee; background-color: #f9f9f9; }
    </style>
</head>
<body>
    <h1>Generate PDF and Upload to Another Server</h1>

    <p>Enter the URL for Puppeteer to convert:</p>
    <input type="text" id="urlInput" value="https://example.com" size="50">
    <button id="triggerPdfBtn">Generate PDF and Upload</button>

    <div id="status"></div>

    <script>
        $(document).ready(function() {
            $('#triggerPdfBtn').on('click', function() {
                const urlToConvert = $('#urlInput').val();
                if (!urlToConvert) {
                    $('#status').html('<span style="color: red;">Please enter a URL.</span>');
                    return;
                }

                $('#status').html('Generating PDF and attempting to upload...');
                $('#triggerPdfBtn').prop('disabled', true); // Disable button during processing

                $.ajax({
                    url: '/generate-and-upload-pdf', // This points to your Puppeteer server
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ urlToConvert: urlToConvert }),
                    success: function(response) {
                        if (response.success) {
                            $('#status').html('<span style="color: green;">' + response.message + '</span><br><pre>' + JSON.stringify(response.targetServerResponse, null, 2) + '</pre>');
                        } else {
                            $('#status').html('<span style="color: red;">Error: ' + response.message + '</span><br><pre>' + JSON.stringify(response.error, null, 2) + '</pre>');
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        $('#status').html('<span style="color: red;">AJAX error: ' + textStatus + ', ' + errorThrown + '</span><br><pre>' + jqXHR.responseText + '</pre>');
                        console.error('AJAX Error:', jqXHR.responseText);
                    },
                    complete: function() {
                        $('#triggerPdfBtn').prop('disabled', false); // Re-enable button
                    }
                });
            });
        });
    </script>
</body>
</html>